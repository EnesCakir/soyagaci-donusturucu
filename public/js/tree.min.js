function elbow(t){return"M"+t.parent.y+","+t.parent.x+"H"+(t.parent.y+(t.y-t.parent.y)/2)+"V"+t.x+"H"+t.y}function wrap(t,e){t.each(function(){for(var t,a=d3.select(this),n=a.text().split(/\s+/).reverse(),o=[],r=0,s=a.attr("y"),d=parseFloat(a.attr("dy")),l=a.text(null).append("tspan").attr("x",0).attr("y",s).attr("dy",d+"em");t=n.pop();)o.push(t),l.text(o.join(" ")),l.node().getComputedTextLength()>e.width-20&&(o.pop(),l.text(o.join(" ")),o=[t],l.attr("dy",d-.6+"em"),l=a.append("tspan").attr("x",0).attr("y",s).attr("dy",1.1*++r+d+"em").text(t))})}function zoomFit(t){var e=svg.node().getBBox(),a=svg.node().parentElement,n=a.clientWidth,o=a.clientHeight,r=e.width,s=e.height,d=e.x+r/2,l=e.y+s/2;if(0!=r&&0!=s){var i=(t||.75)/Math.max(r/n,s/o),m=[n/2-i*d,o/2-i*l];svg.call(zoom.transform,d3.zoomIdentity.translate(m[0],m[1]).scale(i))}}var margin={top:300,right:200,bottom:300,left:200},treeSize={width:1e3,height:500},boxSize={width:150,height:40},nodeSize={width:100,height:200},zoom=d3.zoom().scaleExtent([.5,2]).on("zoom",function(){svg.attr("transform",d3.event.transform)}),ftree=d3.tree().nodeSize([nodeSize.width,nodeSize.height]).separation(function(){return.5}),root=ftree(d3.hierarchy(data,function(t){return t.parents})),nodes=root.descendants(),links=root.descendants().slice(1),svg=d3.select("#tree").append("svg").append("g");d3.select("svg").call(zoom),d3.select("svg").call(zoom.transform,d3.zoomIdentity.translate(margin.left,margin.top)),svg.selectAll("path.link").data(links).enter().append("path").attr("class","link").attr("d",elbow);var node=svg.selectAll("g.person").data(nodes).enter().append("g").attr("class",function(t){return"person person-"+t.data.id+("Erkek"==t.data.gender?" male":" female")}).attr("id",function(t){return 0==t.data.level?"root":null}).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});node.append("rect").attr("x",-boxSize.width/2).attr("y",-boxSize.height/2).attr("width",boxSize.width).attr("height",boxSize.height),node.append("text").attr("dx",0).attr("dy","0.3em").attr("text-anchor","middle").attr("class","name").text(function(t){return t.data.last_name?t.data.first_name+" "+t.data.last_name:t.data.first_name}).call(wrap,boxSize),svg.selectAll("g.person").on("click",function(t){var e=t.data;$("#person-modal .fname").text(e.first_name),$("#person-modal .lname").text(e.last_name),$("#person-modal .bplace").text(e.birth_place),$("#person-modal .bday").text(e.birth_at),$("#person-modal .dday").text(e.death_at),$("#person-modal .rel").text(e.relation),$("#person-modal .fatname").text(e.father_name),$("#person-modal .motname").text(e.mother_name),$("#person-modal .city").text(e.city),$("#person-modal .district").text(e.district),$("#person-modal .hometown").text(e.hometown),$("#person-modal .mstatus").text(e.marriage_status),$("#person-modal .gender").text(e.gender),$("#person-modal .status").text(e.status),$("#person-modal").modal("show")}),svg.selectAll("g.person").on("mouseover",function(t){d3.select(this).classed("person-hover",!0)}),svg.selectAll("g.person").on("mouseout",function(t){d3.select(this).classed("person-hover",!1)});